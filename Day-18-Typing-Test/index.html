<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Day 18: Speed Typer</title>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            background: #323437;
            color: #d1d0c5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        h1 { color: #e2b714; margin-bottom: 20px; }

        .container {
            background: #2c2e31;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 700px;
            text-align: center;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.2em;
            color: #646669;
        }
        
        .stat-val { color: #e2b714; font-weight: bold; }

        .quote-display {
            font-size: 1.5em;
            line-height: 1.5;
            margin-bottom: 20px;
            text-align: left;
            min-height: 100px;
        }

        .correct { color: #d1d0c5; } 
        .incorrect { color: #ca4754; text-decoration: underline; }
        .current {
            border-left: 2px solid #e2b714;
            background-color: rgba(226, 183, 20, 0.2);
            color: white !important;
            font-weight: bold;
            transform: scale(1.2);
            display: inline-block; 
        }
        .pending { color: #646669; }

        textarea {
            width: 100%;
            height: 100px;
            opacity: 0; 
            position: absolute;
            z-index: -1;
        }

        button {
            background: #e2b714;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            color: #323437;
            margin-top: 20px;
        }
        button:hover { background: #d1a812; }

    </style>
</head>
<body>

    <h1>âš¡ Speed Typer</h1>
    <h3 style="color: #646669; margin-top: 0;">Best WPM: <span id="best-wpm" style="color: #e2b714;">0</span></h3> 
    <div class="container" onclick="focusInput()">
        <div class="stats">
            <span>Time: <span id="timer" class="stat-val">0</span>s</span>
            <span>WPM: <span id="wpm" class="stat-val">0</span></span>
            <span>Accuracy: <span id="accuracy" class="stat-val">100</span>%</span>
            <span>Errors: <span id="errors" class="stat-val" style="color: #ca4754;">0</span></span>
        </div>

        <div class="quote-display" id="quoteDisplay">Loading...</div>
        
        <textarea id="quoteInput" autofocus></textarea>

        <button onclick="renderNewQuote()">ðŸ”„ Restart Test</button>
    </div>

    <script>
        const quotes = [
            "The quick brown fox jumps over the lazy dog.",
            "To be or not to be, that is the question.",
            "All that glitters is not gold.",
            "Coding is not just code, that is a puzzle to be solved.",
            "Programs must be written for people to read, and only incidentally for machines to execute."
        ];

        const quoteDisplay = document.getElementById('quoteDisplay');
        const quoteInput = document.getElementById('quoteInput');
        const timerElement = document.getElementById('timer');
        const wpmElement = document.getElementById('wpm');
        const accElement = document.getElementById('accuracy');
        const errorElement = document.getElementById('errors');
        const clickSound = new Audio('https://www.soundjay.com/buttons/sounds/button-16.mp3'); 
        let startTime;
        let timerInterval;
        let isRunning = false;

        const RANDOM_QUOTE_API_URL = 'https://dummyjson.com/quotes/random';

        async function renderNewQuote() {
            quoteDisplay.innerHTML = 'Loading Quote...';

            try {
                const response = await fetch(RANDOM_QUOTE_API_URL);
                const data = await response.json();
                const quote = data.quote; 

                quoteDisplay.innerHTML = '';
                quote.split('').forEach(character => {
                    const characterSpan = document.createElement('span');
                    characterSpan.innerText = character;
                    characterSpan.classList.add('pending');
                    quoteDisplay.appendChild(characterSpan);
                });

                quoteDisplay.querySelector('span').classList.add('current');

                quoteInput.value = null;
                resetTimer();
            } catch (error) {
                quoteDisplay.innerText = "Error fetching quote. Check internet.";
            }
        }

        quoteInput.addEventListener('input', () => {
            if (!isRunning) startTimer();

            const arrayQuote = quoteDisplay.querySelectorAll('span');
            const arrayValue = quoteInput.value.split('');
            let correct = true;
            let correctChars = 0;

            arrayQuote.forEach((characterSpan, index) => {
                const character = arrayValue[index];

                if (character == null) {
                    characterSpan.classList.remove('correct');
                    characterSpan.classList.remove('incorrect');
                    characterSpan.classList.add('pending');
                    correct = false;
                } else if (character === characterSpan.innerText) {
                    characterSpan.classList.add('correct');
                    characterSpan.classList.remove('incorrect');
                    characterSpan.classList.remove('pending');
                    correctChars++;
                } else {
                    if (!characterSpan.classList.contains('incorrect')) {
                        let currentErrors = parseInt(errorElement.innerText);
                        errorElement.innerText = currentErrors + 1;
                    }
                    characterSpan.classList.remove('correct');
                    characterSpan.classList.add('incorrect');
                    characterSpan.classList.remove('pending');
                    correct = false;
                }

             arrayQuote.forEach(span => span.classList.remove('current'));

                if (arrayValue.length < arrayQuote.length) {
                    arrayQuote[arrayValue.length].classList.add('current');
                }
            });

            const accuracy = Math.round((correctChars / arrayValue.length) * 100) || 100;
            accElement.innerText = accuracy;

            if (correct && arrayValue.length === arrayQuote.length) {
                endGame();
            }
            clickSound.currentTime = 0; 
            clickSound.play();
        });

        function startTimer() {
            isRunning = true;
            startTime = new Date();
            timerInterval = setInterval(() => {
                const timeInSeconds = getTimerTime();
                timerElement.innerText = timeInSeconds;
                
                const words = quoteInput.value.length / 5;
                const minutes = timeInSeconds / 60;
                const wpm = Math.floor(words / minutes) || 0;
                wpmElement.innerText = wpm;
            }, 1000);
        }

        function getTimerTime() {
            return Math.floor((new Date() - startTime) / 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerElement.innerText = 0;
            wpmElement.innerText = 0;
            accElement.innerText = 100;
            isRunning = false;
            errorElement.innerText = 0;
        }

        function endGame() {
            clearInterval(timerInterval);
            isRunning = false;
            document.body.style.background = "#2d3436";
            setTimeout(() => document.body.style.background = "#323437", 200);
            const currentWpm = parseInt(wpmElement.innerText);
            const bestWpm = parseInt(localStorage.getItem('bestWPM')) || 0;

            if (currentWpm > bestWpm) {
                localStorage.setItem('bestWPM', currentWpm);
                bestWpmElement.innerText = currentWpm;
                alert("ðŸŽ‰ NEW HIGH SCORE!");
            }          
        }

        function focusInput() {
            quoteInput.focus();
        }
        const bestWpmElement = document.getElementById('best-wpm');
        const savedScore = localStorage.getItem('bestWPM') || 0;
        bestWpmElement.innerText = savedScore;

        renderNewQuote();
    </script>
</body>
</html>